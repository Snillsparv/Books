<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bokcirkeln - V&aring;r n&auml;sta bok</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --cream: #faf6f1;
            --dark: #1a1a2e;
            --gold: #c9a84c;
            --gold-light: #e8d498;
            --wine: #722f37;
            --wine-light: #9b4d54;
            --teal: #2d6a6a;
            --teal-light: #3d8a8a;
            --paper: #f5f0e8;
            --ink: #2c2c2c;
            --muted: #6b6b6b;
            --shadow: rgba(26, 26, 46, 0.12);
            --shadow-heavy: rgba(26, 26, 46, 0.25);
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--cream);
            color: var(--ink);
            line-height: 1.7;
            overflow-x: hidden;
        }

        /* ── Hero Section ── */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            background: linear-gradient(160deg, var(--dark) 0%, #16213e 50%, #0f3460 100%);
            color: var(--cream);
            position: relative;
            overflow: hidden;
            padding: 2rem;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background:
                radial-gradient(ellipse at 20% 50%, rgba(201, 168, 76, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(114, 47, 55, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 80%, rgba(45, 106, 106, 0.08) 0%, transparent 50%);
        }

        .hero-particles {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            overflow: hidden;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            font-size: 1.4rem;
            opacity: 0;
            animation: float-up linear infinite;
            user-select: none;
        }

        @keyframes float-up {
            0% { opacity: 0; transform: translateY(100vh) rotate(0deg); }
            10% { opacity: 0.25; }
            90% { opacity: 0.25; }
            100% { opacity: 0; transform: translateY(-10vh) rotate(360deg); }
        }

        .hero-content {
            position: relative;
            z-index: 1;
        }

        .hero-overline {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            letter-spacing: 0.35em;
            text-transform: uppercase;
            color: var(--gold);
            margin-bottom: 1.5rem;
            opacity: 0;
            animation: fadeInUp 0.8s ease forwards 0.3s;
        }

        .hero h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 900;
            line-height: 1.1;
            margin-bottom: 1.5rem;
            opacity: 0;
            animation: fadeInUp 0.8s ease forwards 0.5s;
        }

        .hero h1 em {
            font-style: italic;
            color: var(--gold-light);
        }

        .hero-subtitle {
            font-size: 1.15rem;
            font-weight: 300;
            color: rgba(250, 246, 241, 0.7);
            max-width: 500px;
            margin: 0 auto 3rem;
            opacity: 0;
            animation: fadeInUp 0.8s ease forwards 0.7s;
        }

        .hero-cta {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 2.5rem;
            background: var(--gold);
            color: var(--dark);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.95rem;
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.05em;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
            animation: fadeInUp 0.8s ease forwards 0.9s;
        }

        .hero-cta:hover {
            background: var(--gold-light);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(201, 168, 76, 0.3);
        }

        .hero-cta svg {
            width: 18px;
            height: 18px;
            transition: transform 0.3s ease;
        }

        .hero-cta:hover svg {
            transform: translateY(3px);
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ── Section Shared ── */
        section {
            padding: 6rem 2rem;
        }

        .section-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .section-header h2 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 0.75rem;
        }

        .section-header p {
            color: var(--muted);
            font-size: 1.05rem;
            max-width: 550px;
            margin: 0 auto;
        }

        /* ── Books Grid ── */
        #books {
            background: var(--paper);
            max-width: 100%;
        }

        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 2.5rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .book-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 20px var(--shadow);
            transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
            cursor: default;
            position: relative;
        }

        .book-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px var(--shadow-heavy);
        }

        .book-card-accent {
            height: 6px;
            width: 100%;
        }

        .book-card-body {
            padding: 2rem 2rem 1.5rem;
        }

        .book-genre {
            display: inline-block;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            padding: 0.3rem 0.8rem;
            border-radius: 50px;
            margin-bottom: 1rem;
        }

        .book-card h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.6rem;
            font-weight: 700;
            line-height: 1.25;
            margin-bottom: 0.3rem;
            color: var(--dark);
        }

        .book-author {
            font-size: 0.95rem;
            color: var(--muted);
            margin-bottom: 1rem;
            font-style: italic;
        }

        .book-year {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--muted);
        }

        .book-description {
            font-size: 0.95rem;
            line-height: 1.8;
            color: #444;
            margin-bottom: 1.25rem;
        }

        .book-quote {
            border-left: 3px solid var(--gold);
            padding: 0.75rem 1rem;
            margin-bottom: 1.25rem;
            background: var(--cream);
            border-radius: 0 8px 8px 0;
        }

        .book-quote p {
            font-family: 'Playfair Display', serif;
            font-style: italic;
            font-size: 0.9rem;
            color: var(--ink);
            line-height: 1.6;
        }

        .book-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .book-tag {
            font-size: 0.75rem;
            padding: 0.25rem 0.7rem;
            background: var(--cream);
            border-radius: 50px;
            color: var(--muted);
            font-weight: 500;
        }

        /* Color Themes per book */
        .theme-ishiguro .book-card-accent { background: linear-gradient(90deg, #e8b4b8, #f5d5c8); }
        .theme-ishiguro .book-genre { background: #fdf0f0; color: #b85c6a; }

        .theme-chiang .book-card-accent { background: linear-gradient(90deg, #64b5f6, #81d4fa); }
        .theme-chiang .book-genre { background: #e8f4fd; color: #1976d2; }

        .theme-eco .book-card-accent { background: linear-gradient(90deg, var(--gold), #d4a843); }
        .theme-eco .book-genre { background: #fdf8ec; color: #8b6914; }

        .theme-vonnegut .book-card-accent { background: linear-gradient(90deg, #ef5350, #ff8a65); }
        .theme-vonnegut .book-genre { background: #fde8e8; color: #c62828; }

        .theme-fowles .book-card-accent { background: linear-gradient(90deg, var(--teal), #4db6ac); }
        .theme-fowles .book-genre { background: #e6f5f5; color: var(--teal); }

        .theme-gibson .book-card-accent { background: linear-gradient(90deg, #7c4dff, #b388ff); }
        .theme-gibson .book-genre { background: #ede7f6; color: #5e35b1; }

        /* ── Voting Section ── */
        #voting {
            background: linear-gradient(160deg, var(--dark) 0%, #16213e 100%);
            color: var(--cream);
            min-height: 80vh;
        }

        #voting .section-header h2 {
            color: var(--cream);
        }

        #voting .section-header p {
            color: rgba(250, 246, 241, 0.6);
        }

        .voting-container {
            max-width: 750px;
            margin: 0 auto;
        }

        /* Steps indicator */
        .steps-indicator {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }

        .step-dot {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .step-dot.active {
            background: var(--gold);
            color: var(--dark);
            font-weight: 600;
        }

        .step-dot.completed {
            background: rgba(201, 168, 76, 0.2);
            color: var(--gold);
        }

        .step-num {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            background: rgba(255, 255, 255, 0.1);
            font-family: 'JetBrains Mono', monospace;
        }

        .step-dot.active .step-num {
            background: var(--dark);
            color: var(--gold);
        }

        .step-dot.completed .step-num {
            background: var(--gold);
            color: var(--dark);
        }

        /* Voter select */
        .voter-select-panel {
            text-align: center;
            margin-bottom: 2rem;
        }

        .voter-select-panel label {
            display: block;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 0.75rem;
            letter-spacing: 0.05em;
        }

        .voter-buttons {
            display: flex;
            justify-content: center;
            gap: 0.6rem;
            flex-wrap: wrap;
        }

        .voter-btn {
            padding: 0.6rem 1.4rem;
            border: 2px solid rgba(255, 255, 255, 0.15);
            background: transparent;
            color: rgba(255, 255, 255, 0.6);
            border-radius: 50px;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.25s ease;
        }

        .voter-btn:hover {
            border-color: var(--gold);
            color: var(--gold);
        }

        .voter-btn.selected {
            border-color: var(--gold);
            background: var(--gold);
            color: var(--dark);
            font-weight: 600;
        }

        .voter-btn .check {
            display: none;
            margin-left: 0.3rem;
        }

        .voter-btn.has-voted .check {
            display: inline;
        }

        .voter-btn.has-voted {
            border-color: rgba(201, 168, 76, 0.4);
            color: rgba(201, 168, 76, 0.6);
        }

        .voter-btn.has-voted.selected {
            border-color: var(--gold);
            background: var(--gold);
            color: var(--dark);
        }

        /* Voting card */
        .vote-instruction {
            text-align: center;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 2rem;
            min-height: 1.5em;
        }

        .vote-instruction strong {
            color: var(--gold-light);
        }

        .vote-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 2rem;
        }

        .vote-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            background: rgba(255, 255, 255, 0.04);
            border: 2px solid rgba(255, 255, 255, 0.08);
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.25s ease;
            user-select: none;
        }

        .vote-option:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .vote-option.selected {
            background: rgba(201, 168, 76, 0.1);
            border-color: var(--gold);
        }

        .vote-option.eliminated {
            opacity: 0.3;
            pointer-events: none;
            text-decoration: line-through;
        }

        .vote-radio {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.25s ease;
        }

        .vote-option.selected .vote-radio {
            border-color: var(--gold);
            background: var(--gold);
        }

        .vote-radio-inner {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--dark);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .vote-option.selected .vote-radio-inner {
            opacity: 1;
        }

        .vote-option-info {
            flex: 1;
        }

        .vote-option-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .vote-option-author {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.4);
        }

        .vote-submit-btn {
            display: block;
            width: 100%;
            padding: 1rem;
            background: var(--gold);
            color: var(--dark);
            border: none;
            border-radius: 14px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.03em;
        }

        .vote-submit-btn:hover:not(:disabled) {
            background: var(--gold-light);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(201, 168, 76, 0.25);
        }

        .vote-submit-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Results */
        .results-panel {
            margin-top: 2rem;
            display: none;
        }

        .results-panel.visible {
            display: block;
        }

        .round-result {
            margin-bottom: 2rem;
        }

        .round-result h4 {
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--gold-light);
        }

        .result-bar-container {
            margin-bottom: 0.75rem;
        }

        .result-bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.3rem;
            font-size: 0.85rem;
        }

        .result-bar-label span:first-child {
            font-weight: 500;
        }

        .result-bar-label span:last-child {
            color: rgba(255, 255, 255, 0.5);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
        }

        .result-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            overflow: hidden;
        }

        .result-bar-fill {
            height: 100%;
            border-radius: 10px;
            background: linear-gradient(90deg, var(--gold), var(--gold-light));
            transition: width 0.8s cubic-bezier(0.165, 0.84, 0.44, 1);
            width: 0%;
        }

        .result-bar-container.eliminated .result-bar-fill {
            background: rgba(255, 255, 255, 0.2);
        }

        .result-bar-container.eliminated .result-bar-label span:first-child {
            text-decoration: line-through;
            opacity: 0.5;
        }

        .elimination-note {
            font-size: 0.8rem;
            color: var(--wine-light);
            font-style: italic;
            margin-top: 0.5rem;
        }

        /* Winner */
        .winner-panel {
            text-align: center;
            padding: 3rem 2rem;
            display: none;
        }

        .winner-panel.visible {
            display: block;
        }

        .winner-trophy {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .winner-panel h3 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: var(--gold-light);
            margin-bottom: 0.5rem;
        }

        .winner-panel p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 1rem;
        }

        .winner-book-title {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            margin: 1rem 0 0.25rem;
        }

        .winner-book-author {
            font-size: 1.1rem;
            color: var(--gold);
            font-style: italic;
        }

        /* Reset button */
        .reset-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 2rem;
            padding: 0.7rem 1.5rem;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.5);
            border-radius: 50px;
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.25s ease;
        }

        .reset-btn:hover {
            border-color: rgba(255, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.8);
        }

        /* ── Robot avatars ── */
        .robot-panel {
            display: flex;
            justify-content: center;
            gap: 1.2rem;
            margin-bottom: 2.5rem;
            flex-wrap: nowrap;
        }

        .robot-avatar {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.4s ease;
        }

        .robot-avatar.voting-now {
            transform: scale(1.15);
        }

        .robot-avatar.voting-now .robot-img-wrap {
            box-shadow: 0 0 20px rgba(201, 168, 76, 0.5), 0 0 40px rgba(201, 168, 76, 0.2);
            border-color: var(--gold);
        }

        .robot-img-wrap {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid rgba(255, 255, 255, 0.15);
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.4s ease;
            position: relative;
        }

        .robot-img-wrap img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.3s ease;
        }

        .robot-avatar .robot-name {
            font-size: 0.75rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.5);
            letter-spacing: 0.03em;
            transition: color 0.3s ease;
        }

        .robot-avatar.voting-now .robot-name {
            color: var(--gold);
            font-weight: 600;
        }

        .robot-avatar.has-voted .robot-img-wrap {
            border-color: rgba(201, 168, 76, 0.4);
        }

        .robot-avatar.has-voted .robot-name::after {
            content: ' \2713';
            color: var(--gold);
        }

        .robot-speech {
            font-size: 0.65rem;
            color: rgba(255, 255, 255, 0.4);
            font-style: italic;
            max-width: 90px;
            text-align: center;
            min-height: 1.2em;
        }

        .winner-robots {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .winner-robots .robot-img-wrap {
            width: 140px;
            height: 140px;
            border-color: var(--gold);
            box-shadow: 0 0 15px rgba(201, 168, 76, 0.3);
        }

        @media (max-width: 600px) {
            .robot-img-wrap {
                width: 120px;
                height: 120px;
            }
            .robot-panel {
                gap: 0.8rem;
            }
        }

        /* Multi-select checkbox style */
        .vote-option .vote-radio {
            border-radius: 6px;
        }
        .vote-option.selected .vote-radio {
            border-radius: 6px;
        }
        .vote-option .vote-radio-inner {
            border-radius: 2px;
            width: 10px;
            height: 10px;
        }

        /* ── Footer ── */
        footer {
            text-align: center;
            padding: 3rem 2rem;
            background: var(--dark);
            color: rgba(255, 255, 255, 0.3);
            font-size: 0.8rem;
        }

        footer span {
            color: var(--gold);
        }

        /* ── Animations on scroll ── */
        .book-card {
            opacity: 0;
            transform: translateY(40px);
            transition: opacity 0.6s ease, transform 0.6s ease, box-shadow 0.4s ease;
        }

        .book-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* ── Responsive ── */
        @media (max-width: 768px) {
            .books-grid {
                grid-template-columns: 1fr;
                padding: 0 0.5rem;
            }

            section {
                padding: 4rem 1.25rem;
            }

            .vote-options {
                grid-template-columns: 1fr;
            }

            .voter-buttons {
                gap: 0.4rem;
            }

            .voter-btn {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
            }

            .step-dot {
                padding: 0.4rem 0.7rem;
                font-size: 0.7rem;
            }
        }

        /* Hidden utility */
        .hidden { display: none !important; }

        /* ═══════════════════════════════════════════
           DYSTOPIAN GLITCH TRANSITION & THEME
           ═══════════════════════════════════════════ */

        /* Glitch overlay that covers the whole screen */
        .glitch-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 9999;
            pointer-events: none;
            opacity: 0;
        }

        .glitch-overlay.active {
            opacity: 1;
            animation: glitch-master 1.8s ease-in-out forwards;
        }

        .glitch-overlay .glitch-bar {
            position: absolute;
            left: 0; right: 0;
            height: 3px;
            background: #ff0033;
            opacity: 0;
        }

        .glitch-overlay.active .glitch-bar {
            animation: glitch-bars 1.8s ease-in-out;
        }

        .glitch-overlay .glitch-block {
            position: absolute;
            background: rgba(255, 0, 51, 0.15);
            opacity: 0;
        }

        .glitch-overlay.active .glitch-block {
            animation: glitch-blocks 1.8s ease-in-out;
        }

        .glitch-text-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            opacity: 0;
        }

        .glitch-text-overlay.active {
            animation: glitch-text-flash 1.8s ease-in-out;
        }

        .glitch-text-overlay .glitch-msg {
            font-family: 'JetBrains Mono', monospace;
            font-size: clamp(1.2rem, 4vw, 2.5rem);
            color: #ff0033;
            text-transform: uppercase;
            letter-spacing: 0.3em;
            text-shadow: 0 0 20px rgba(255, 0, 51, 0.8), 0 0 60px rgba(255, 0, 51, 0.4);
        }

        @keyframes glitch-master {
            0% { opacity: 0; background: transparent; }
            5% { opacity: 1; background: rgba(255, 0, 51, 0.05); }
            10% { background: rgba(0, 0, 0, 0.3); }
            15% { background: rgba(255, 0, 51, 0.1); }
            20% { background: rgba(0, 0, 0, 0.6); }
            30% { background: rgba(255, 0, 51, 0.03); }
            40% { background: rgba(0, 0, 0, 0.8); }
            50% { background: rgba(0, 0, 0, 0.95); }
            60% { background: rgba(255, 0, 51, 0.05); }
            70% { background: rgba(0, 0, 0, 0.98); }
            85% { background: rgba(0, 0, 0, 1); }
            100% { opacity: 0; background: transparent; }
        }

        @keyframes glitch-bars {
            0%, 100% { opacity: 0; }
            5% { opacity: 1; top: 20%; }
            8% { opacity: 0; }
            12% { opacity: 1; top: 55%; }
            15% { opacity: 0; }
            22% { opacity: 1; top: 30%; height: 5px; }
            25% { opacity: 0; }
            35% { opacity: 1; top: 70%; height: 2px; }
            38% { opacity: 0; }
            45% { opacity: 0.6; top: 15%; height: 8px; }
            48% { opacity: 0; }
            60% { opacity: 0; }
        }

        @keyframes glitch-blocks {
            0%, 100% { opacity: 0; }
            10% { opacity: 1; top: 10%; left: 5%; width: 30%; height: 10%; }
            13% { opacity: 0; }
            20% { opacity: 1; top: 60%; left: 40%; width: 50%; height: 5%; }
            23% { opacity: 0; }
            30% { opacity: 1; top: 30%; left: 20%; width: 40%; height: 15%; }
            35% { opacity: 0; }
            50% { opacity: 0; }
        }

        @keyframes glitch-text-flash {
            0%, 100% { opacity: 0; }
            35% { opacity: 0; }
            40% { opacity: 1; transform: translate(-3px, 2px); }
            42% { opacity: 0; }
            45% { opacity: 1; transform: translate(3px, -1px); }
            47% { opacity: 0; }
            55% { opacity: 1; transform: translate(0, 0); }
            65% { opacity: 1; }
            75% { opacity: 0; }
        }

        /* Screen shake during glitch */
        .screen-shake {
            animation: screen-shake 0.4s ease-in-out;
        }

        @keyframes screen-shake {
            0%, 100% { transform: translate(0, 0); }
            10% { transform: translate(-5px, 3px); }
            20% { transform: translate(5px, -3px); }
            30% { transform: translate(-3px, -5px); }
            40% { transform: translate(3px, 5px); }
            50% { transform: translate(-5px, -2px); }
            60% { transform: translate(4px, 2px); }
            70% { transform: translate(-2px, 4px); }
            80% { transform: translate(2px, -4px); }
            90% { transform: translate(-3px, 3px); }
        }

        /* ── DYSTOPIAN MODE ── */
        body.dystopian {
            --cream: #0a0a0a;
            --dark: #0d0d0d;
            --gold: #ff0033;
            --gold-light: #ff3355;
            --wine: #cc0022;
            --wine-light: #ff1a40;
            --teal: #ff0033;
            --teal-light: #ff3355;
            --paper: #0d0d0d;
            --ink: #e0e0e0;
            --muted: #888;
            --shadow: rgba(255, 0, 51, 0.1);
            --shadow-heavy: rgba(255, 0, 51, 0.25);
            background: #0a0a0a;
            color: #e0e0e0;
        }

        body.dystopian .hero {
            background: linear-gradient(160deg, #0a0a0a 0%, #1a0000 50%, #0d0d0d 100%);
        }

        body.dystopian .hero::before {
            background:
                radial-gradient(ellipse at 20% 50%, rgba(255, 0, 51, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 20%, rgba(255, 0, 51, 0.04) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 80%, rgba(200, 0, 40, 0.05) 0%, transparent 50%);
        }

        body.dystopian .hero-overline {
            color: #ff0033;
        }

        body.dystopian .hero h1 em {
            color: #ff0033;
        }

        body.dystopian .hero-subtitle {
            color: rgba(255, 255, 255, 0.5);
        }

        body.dystopian .particle {
            color: #ff0033 !important;
        }

        /* Dystopian section header */
        body.dystopian .section-header h2 {
            color: #ff0033;
            text-shadow: 0 0 30px rgba(255, 0, 51, 0.3);
        }

        body.dystopian .section-header p {
            color: #888;
        }

        /* Dystopian book cards */
        body.dystopian #books {
            background: #0d0d0d;
        }

        body.dystopian .book-card {
            background: #111;
            border: 1px solid rgba(255, 0, 51, 0.15);
            box-shadow: 0 0 20px rgba(255, 0, 51, 0.05);
        }

        body.dystopian .book-card:hover {
            box-shadow: 0 0 40px rgba(255, 0, 51, 0.15);
            border-color: rgba(255, 0, 51, 0.4);
        }

        body.dystopian .book-card-accent {
            background: linear-gradient(90deg, #ff0033, #cc0022) !important;
        }

        body.dystopian .book-card h3 {
            color: #ff3355;
        }

        body.dystopian .book-author {
            color: #888;
        }

        body.dystopian .book-description {
            color: #aaa;
        }

        body.dystopian .book-quote {
            border-left-color: #ff0033;
            background: rgba(255, 0, 51, 0.05);
        }

        body.dystopian .book-quote p {
            color: #ccc;
        }

        body.dystopian .book-genre {
            background: rgba(255, 0, 51, 0.1) !important;
            color: #ff0033 !important;
        }

        body.dystopian .book-tag {
            background: rgba(255, 0, 51, 0.08);
            color: #ff3355;
            border: 1px solid rgba(255, 0, 51, 0.15);
        }

        /* Dystopian voting section */
        body.dystopian #voting {
            background: linear-gradient(160deg, #0a0a0a 0%, #1a0000 100%);
            color: #e0e0e0;
        }

        body.dystopian #voting .section-header h2 {
            color: #ff3355;
        }

        body.dystopian .voter-btn:hover {
            border-color: #ff0033;
            color: #ff0033;
        }

        body.dystopian .voter-btn.selected {
            border-color: #ff0033;
            background: #ff0033;
            color: #0a0a0a;
        }

        body.dystopian .vote-option.selected {
            background: rgba(255, 0, 51, 0.1);
            border-color: #ff0033;
        }

        body.dystopian .vote-option.selected .vote-radio {
            border-color: #ff0033;
            background: #ff0033;
        }

        body.dystopian .vote-submit-btn {
            background: #ff0033;
            color: #0a0a0a;
        }

        body.dystopian .vote-submit-btn:hover:not(:disabled) {
            background: #ff3355;
            box-shadow: 0 8px 25px rgba(255, 0, 51, 0.3);
        }

        body.dystopian .step-dot.active {
            background: #ff0033;
            color: #0a0a0a;
        }

        body.dystopian .step-dot.active .step-num {
            background: #0a0a0a;
            color: #ff0033;
        }

        body.dystopian .step-dot.completed {
            background: rgba(255, 0, 51, 0.2);
            color: #ff0033;
        }

        body.dystopian .step-dot.completed .step-num {
            background: #ff0033;
            color: #0a0a0a;
        }

        body.dystopian .robot-avatar.voting-now .robot-img-wrap {
            box-shadow: 0 0 20px rgba(255, 0, 51, 0.5), 0 0 40px rgba(255, 0, 51, 0.2);
            border-color: #ff0033;
        }

        body.dystopian .robot-avatar.voting-now .robot-name {
            color: #ff0033;
        }

        body.dystopian .robot-avatar.has-voted .robot-img-wrap {
            border-color: rgba(255, 0, 51, 0.4);
        }

        body.dystopian .robot-avatar.has-voted .robot-name::after {
            color: #ff0033;
        }

        body.dystopian .winner-robots .robot-img-wrap {
            border-color: #ff0033;
            box-shadow: 0 0 15px rgba(255, 0, 51, 0.3);
        }

        body.dystopian .result-bar-fill {
            background: linear-gradient(90deg, #ff0033, #ff3355);
        }

        body.dystopian .round-result h4 {
            color: #ff3355;
        }

        body.dystopian .winner-panel h3 {
            color: #ff3355;
        }

        body.dystopian .winner-book-title {
            color: #fff;
        }

        body.dystopian .winner-book-author {
            color: #ff0033;
        }

        body.dystopian .voter-btn.has-voted {
            border-color: rgba(255, 0, 51, 0.4);
            color: rgba(255, 0, 51, 0.6);
        }

        body.dystopian .vote-instruction strong {
            color: #ff3355;
        }

        body.dystopian footer {
            background: #0a0a0a;
            border-top: 1px solid rgba(255, 0, 51, 0.1);
        }

        body.dystopian footer span {
            color: #ff0033;
        }

        /* Scanline effect on dystopian mode */
        body.dystopian::after {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 9998;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 0, 0, 0.08) 2px,
                rgba(0, 0, 0, 0.08) 4px
            );
        }

        /* Subtle CRT flicker */
        body.dystopian {
            animation: crt-flicker 8s ease-in-out infinite;
        }

        @keyframes crt-flicker {
            0%, 100% { opacity: 1; }
            92% { opacity: 1; }
            93% { opacity: 0.97; }
            94% { opacity: 1; }
            96% { opacity: 0.98; }
            97% { opacity: 1; }
        }

        /* ── FULL-PAGE BOOK PAGES (dystopian mode) ── */
        .book-pages-container {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 100;
            overflow: hidden;
            background: #0a0a0a;
        }

        .book-pages-container.active {
            display: block;
        }

        .book-page {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            width: 100%;
            height: 100vh;
            background-image: url('bg_röd.png');
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.6s ease, transform 0.6s ease;
            transform: scale(0.97);
            padding: 2rem;
        }

        .book-page.active {
            opacity: 1;
            pointer-events: auto;
            transform: scale(1);
        }

        /* Dark overlay on bg for readability */
        .book-page::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.55);
            z-index: 0;
        }

        /* Scanline effect on book pages */
        .book-page::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 1;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 0, 0, 0.06) 2px,
                rgba(0, 0, 0, 0.06) 4px
            );
        }

        .book-page-inner {
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 4rem;
            max-width: 1100px;
            width: 100%;
        }

        .book-page-cover {
            flex-shrink: 0;
            width: 300px;
            perspective: 900px;
        }

        .book-page-cover .cover-flipper {
            position: relative;
            width: 100%;
            transition: transform 0.8s ease;
            transform-style: preserve-3d;
        }

        .book-page-cover.revealed .cover-flipper {
            transform: rotateY(180deg);
        }

        .book-page-cover .cover-front,
        .book-page-cover .cover-back {
            backface-visibility: hidden;
            border-radius: 8px;
            overflow: hidden;
        }

        .book-page-cover .cover-front {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #111;
            border: 2px solid rgba(255, 0, 51, 0.25);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6), 0 0 40px rgba(255, 0, 51, 0.15);
            cursor: default;
        }

        .book-page-cover .cover-front .cover-mystery {
            text-align: center;
            padding: 2rem;
        }

        .book-page-cover .cover-front .cover-mystery .mystery-icon {
            font-size: 3rem;
            display: block;
            margin-bottom: 1rem;
            opacity: 0.6;
        }

        .book-page-cover .cover-front .cover-mystery .mystery-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            color: rgba(255, 0, 51, 0.5);
        }

        .book-page-cover .cover-back {
            width: 100%;
            transform: rotateY(180deg);
        }

        .book-page-cover .cover-back img {
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6), 0 0 40px rgba(255, 0, 51, 0.15);
            display: block;
        }

        /* Redacted info state */
        .book-page-info {
            flex: 1;
            color: #e0e0e0;
        }

        .book-page-info.redacted h2,
        .book-page-info.redacted .page-author,
        .book-page-info.redacted .page-description,
        .book-page-info.redacted .page-quote,
        .book-page-info.redacted .page-tags,
        .book-page-info.redacted .page-genre {
            position: relative;
            color: transparent !important;
            user-select: none;
        }

        .book-page-info.redacted h2 *,
        .book-page-info.redacted .page-author *,
        .book-page-info.redacted .page-description *,
        .book-page-info.redacted .page-quote *,
        .book-page-info.redacted .page-tags * {
            color: transparent !important;
        }

        .book-page-info.redacted h2::after,
        .book-page-info.redacted .page-author::after,
        .book-page-info.redacted .page-description::after,
        .book-page-info.redacted .page-quote::after {
            content: '';
            position: absolute;
            top: 0.2em; left: 0; right: 0; bottom: 0.2em;
            background: repeating-linear-gradient(
                0deg,
                rgba(255, 0, 51, 0.15) 0px,
                rgba(255, 0, 51, 0.15) 1.1em,
                transparent 1.1em,
                transparent 1.5em
            );
            border-radius: 4px;
        }

        .book-page-info.redacted .page-tags::after {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 60%;
            height: 100%;
            background: rgba(255, 0, 51, 0.12);
            border-radius: 50px;
        }

        .book-page-info.redacted .page-genre::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255, 0, 51, 0.12);
            border-radius: 50px;
        }

        /* Reveal button */
        .reveal-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
            padding: 0.75rem 1.8rem;
            background: transparent;
            border: 1px solid rgba(255, 0, 51, 0.4);
            color: #ff3355;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reveal-btn:hover {
            background: rgba(255, 0, 51, 0.1);
            border-color: #ff3355;
            box-shadow: 0 0 20px rgba(255, 0, 51, 0.15);
        }

        .reveal-btn.hidden {
            display: none;
        }

        /* Revealed info animation */
        .book-page-info.revealing h2,
        .book-page-info.revealing .page-author,
        .book-page-info.revealing .page-description,
        .book-page-info.revealing .page-quote,
        .book-page-info.revealing .page-tags,
        .book-page-info.revealing .page-genre {
            animation: revealText 0.5s ease forwards;
        }
        .book-page-info.revealing .page-author { animation-delay: 0.08s; }
        .book-page-info.revealing .page-genre { animation-delay: 0.12s; }
        .book-page-info.revealing .page-description { animation-delay: 0.2s; }
        .book-page-info.revealing .page-quote { animation-delay: 0.35s; }
        .book-page-info.revealing .page-tags { animation-delay: 0.45s; }

        @keyframes revealText {
            0% { opacity: 0; transform: translateY(5px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .book-page-info .page-label {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 0.4em;
            text-transform: uppercase;
            color: rgba(255, 0, 51, 0.6);
            margin-bottom: 0.75rem;
            display: block;
        }

        .book-page-info h2 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2rem, 5vw, 3.2rem);
            font-weight: 700;
            color: #fff;
            line-height: 1.15;
            margin-bottom: 0.4rem;
            text-shadow: 0 0 40px rgba(255, 0, 51, 0.2);
        }

        .book-page-info .page-author {
            font-size: 1.1rem;
            font-style: italic;
            color: #ff3355;
            margin-bottom: 1.5rem;
        }

        .book-page-info .page-author .page-year {
            font-style: normal;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.35);
            margin-left: 0.5rem;
        }

        .book-page-info .page-description {
            font-size: 1rem;
            line-height: 1.85;
            color: rgba(255, 255, 255, 0.75);
            margin-bottom: 1.5rem;
            max-width: 550px;
        }

        .book-page-info .page-quote {
            border-left: 3px solid #ff0033;
            padding: 0.75rem 1.25rem;
            margin-bottom: 1.5rem;
            background: rgba(255, 0, 51, 0.06);
            border-radius: 0 8px 8px 0;
            max-width: 550px;
        }

        .book-page-info .page-quote p {
            font-family: 'Playfair Display', serif;
            font-style: italic;
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.6;
        }

        .book-page-info .page-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .book-page-info .page-tag {
            font-size: 0.75rem;
            padding: 0.3rem 0.8rem;
            background: rgba(255, 0, 51, 0.08);
            border: 1px solid rgba(255, 0, 51, 0.2);
            border-radius: 50px;
            color: #ff3355;
            font-weight: 500;
        }

        .book-page-info .page-genre {
            display: inline-block;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            padding: 0.3rem 0.8rem;
            border-radius: 50px;
            margin-bottom: 1rem;
            background: rgba(255, 0, 51, 0.1);
            color: #ff0033;
        }

        /* Page navigation */
        .page-nav {
            position: fixed;
            bottom: 2.5rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 200;
            display: none;
            align-items: center;
            gap: 2rem;
        }

        .page-nav.active {
            display: flex;
        }

        .page-nav-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid rgba(255, 0, 51, 0.3);
            background: rgba(0, 0, 0, 0.6);
            color: #ff0033;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'JetBrains Mono', monospace;
            backdrop-filter: blur(10px);
        }

        .page-nav-btn:hover {
            border-color: #ff0033;
            background: rgba(255, 0, 51, 0.15);
            box-shadow: 0 0 20px rgba(255, 0, 51, 0.3);
        }

        .page-nav-counter {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            color: #ff0033;
            letter-spacing: 0.2em;
            text-shadow: 0 0 10px rgba(255, 0, 51, 0.3);
        }

        .page-nav-dots {
            display: flex;
            gap: 0.5rem;
        }

        .page-nav-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 0, 51, 0.15);
            border: 1px solid rgba(255, 0, 51, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-nav-dot.active {
            background: #ff0033;
            box-shadow: 0 0 10px rgba(255, 0, 51, 0.5);
        }

        /* Vote button in navigation bar */
        .page-nav-vote-btn {
            padding: 0.6rem 1.5rem;
            background: #ff0033;
            color: #0a0a0a;
            border: none;
            border-radius: 50px;
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 0.03em;
            margin-left: 0.5rem;
        }

        .page-nav-vote-btn:hover {
            background: #ff3355;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 0, 51, 0.3);
        }

        /* Vote button on book pages (unused, kept for future) */
        .page-vote-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.9rem 2rem;
            background: #ff0033;
            color: #0a0a0a;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.05em;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1.5rem;
        }

        .page-vote-btn:hover {
            background: #ff3355;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 0, 51, 0.3);
        }

        .page-vote-btn svg {
            width: 16px;
            height: 16px;
        }

        /* Responsive book pages */
        @media (max-width: 900px) {
            .book-page-inner {
                flex-direction: column;
                text-align: center;
                gap: 2rem;
                overflow-y: auto;
                max-height: calc(100vh - 6rem);
                padding-bottom: 5rem;
            }

            .book-page-cover {
                width: 200px;
            }

            .book-page-info .page-quote,
            .book-page-info .page-description {
                max-width: 100%;
            }

            .book-page-info .page-tags {
                justify-content: center;
            }

            .page-nav {
                bottom: 1.5rem;
                gap: 1rem;
            }

            .page-nav-btn {
                width: 42px;
                height: 42px;
                font-size: 1.1rem;
            }
        }

        @media (max-width: 480px) {
            .book-page-cover {
                width: 160px;
            }

            .book-page {
                padding: 1.25rem;
            }
        }

        /* Hide books card section in dystopian mode (presentation replaces it) */
        body.dystopian #books {
            display: none;
        }

        body.dystopian #books .section-header {
            display: none;
        }

        /* ── Robot Game ── */
        .robot-game-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 8000;
            background: #0a0a0a;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .robot-game-overlay.active {
            display: flex;
        }

        .game-video-screen {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 5;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .game-video-screen video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .robot-game-hud {
            position: absolute;
            top: 0; left: 0; right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            z-index: 2;
            font-family: 'JetBrains Mono', monospace;
            color: #e0e0e0;
        }

        .robot-game-hud .hud-player {
            font-size: 1.1rem;
            color: #ff3355;
            font-weight: 600;
        }

        .robot-game-hud .hud-timer {
            font-size: 2rem;
            color: #ff0033;
            text-shadow: 0 0 20px rgba(255, 0, 51, 0.5);
        }

        .robot-game-hud .hud-score {
            font-size: 1.1rem;
        }

        #robotGameCanvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .game-start-screen, .game-scores-screen {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 3;
            background: rgba(10, 10, 10, 0.92);
            color: #e0e0e0;
            text-align: center;
            font-family: 'Inter', sans-serif;
        }

        .game-start-screen h2, .game-scores-screen h2 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            color: #ff3355;
            margin-bottom: 0.5rem;
        }

        .game-start-screen p {
            max-width: 400px;
            margin-bottom: 2rem;
            color: rgba(255, 255, 255, 0.6);
            line-height: 1.6;
        }

        .game-start-screen .player-up {
            font-size: 1.3rem;
            color: #ff3355;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .game-start-btn, .game-next-btn {
            padding: 0.9rem 2.5rem;
            background: #ff0033;
            color: #0a0a0a;
            border: none;
            border-radius: 50px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s ease;
        }

        .game-start-btn:hover, .game-next-btn:hover {
            background: #ff3355;
            box-shadow: 0 8px 25px rgba(255, 0, 51, 0.3);
        }

        .game-scores-screen .score-list {
            list-style: none;
            margin: 1.5rem 0 2rem;
            width: 100%;
            max-width: 350px;
        }

        .game-scores-screen .score-list li {
            display: flex;
            justify-content: space-between;
            padding: 0.7rem 1.2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
        }

        .game-scores-screen .score-list li .score-name {
            color: #ff3355;
        }

        .game-scores-screen .score-list li .score-val {
            color: #e0e0e0;
        }
    </style>
</head>
<body>

<!-- ════════════════ HERO ════════════════ -->
<section class="hero">
    <div class="hero-particles" id="particles"></div>
    <div class="hero-content">
        <div class="hero-overline">Jonas &middot; Jessan &middot; Josse &middot; Bulf &middot; Emilie</div>
        <h1>V&aring;r n&auml;sta <em>bok</em></h1>
        <p class="hero-subtitle">Sex fantastiska b&ouml;cker. Fem l&auml;sare. En bok att dela. Utforska titlarna och r&ouml;sta p&aring; din favorit.</p>
        <button class="hero-cta" id="exploreBooksBtn">
            Utforska b&ouml;ckerna
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></svg>
        </button>
        <button class="hero-cta" id="enterBooksBtn" style="display:none;">
            &Ouml;ppna b&ouml;ckerna
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </button>
    </div>
</section>

<!-- ════════════════ BOOKS ════════════════ -->
<section id="books">
    <div class="section-header">
        <h2>B&ouml;ckerna</h2>
        <p>Varje bok &auml;r en resa. L&auml;s, k&auml;nn, och l&aring;t dig f&ouml;rf&ouml;ras &mdash; sedan r&ouml;star vi.</p>
    </div>

    <div class="books-grid">

        <!-- Klara och Solen -->
        <div class="book-card theme-ishiguro">
            <div class="book-card-accent"></div>
            <div class="book-card-body">
                <span class="book-genre">Litteratur &middot; Sci-fi</span>
                <h3>Klara och Solen</h3>
                <p class="book-author">Kazuo Ishiguro &nbsp;<span class="book-year">2021</span></p>
                <p class="book-description">
                    Ber&auml;ttad genom &ouml;gonen p&aring; Klara, en artificiell v&auml;n som observerar v&auml;rlden fr&aring;n ett skyltf&ouml;nster.
                    Med sin ovanliga blick avsl&ouml;jar hon vad det inneb&auml;r att &auml;lska, att vara ensam och att vara m&auml;nsklig.
                    Ishiguro skriver med en stillsam sk&ouml;nhet som sm&auml;lter hj&auml;rtat.
                </p>
                <div class="book-quote">
                    <p>&rdquo;Solen v&auml;rmde alltid n&aring;gon. Det var hennes s&auml;tt att visa v&auml;nlighet.&rdquo;</p>
                </div>
                <div class="book-tags">
                    <span class="book-tag">Nobelpristagare</span>
                    <span class="book-tag">AI &amp; m&auml;nsklighet</span>
                    <span class="book-tag">&Ouml;mhet</span>
                </div>
            </div>
        </div>

        <!-- Exhalation -->
        <div class="book-card theme-chiang">
            <div class="book-card-accent"></div>
            <div class="book-card-body">
                <span class="book-genre">Sci-fi &middot; Noveller</span>
                <h3>Exhalation</h3>
                <p class="book-author">Ted Chiang &nbsp;<span class="book-year">2019</span></p>
                <p class="book-description">
                    Nio noveller som utforskar fri vilja, tidens natur och vad det inneb&auml;r att vara medveten.
                    Ted Chiang skriver science fiction som f&aring;r en att stanna upp mitt i en mening och t&auml;nka:
                    &rdquo;S&aring; har jag aldrig sett p&aring; det f&ouml;rut.&rdquo; Varje ber&auml;ttelse &auml;r en liten juvel.
                </p>
                <div class="book-quote">
                    <p>&rdquo;The universe began as an enormous breath being held.&rdquo;</p>
                </div>
                <div class="book-tags">
                    <span class="book-tag">Tankeexperiment</span>
                    <span class="book-tag">Filosofisk sci-fi</span>
                    <span class="book-tag">Briljant</span>
                </div>
            </div>
        </div>

        <!-- Foucaults pendel -->
        <div class="book-card theme-eco">
            <div class="book-card-accent"></div>
            <div class="book-card-body">
                <span class="book-genre">Litteratur &middot; Mysterium</span>
                <h3>Foucaults pendel</h3>
                <p class="book-author">Umberto Eco &nbsp;<span class="book-year">1988</span></p>
                <p class="book-description">
                    Tre f&ouml;rlagsredakt&ouml;rer hittar p&aring; en gigantisk konspiration f&ouml;r skojs skull &mdash;
                    tills den b&ouml;rjar bli verklig. En labyrintisk, intellektuell thriller som v&auml;ver samman
                    tempelriddare, kabbala och hemliga s&auml;llskap. F&ouml;r dig som &auml;lskar att g&aring; vilse i tankar.
                </p>
                <div class="book-quote">
                    <p>&rdquo;Jag tror att det finns ber&auml;ttelser som man bara kan ber&auml;tta f&ouml;r sig sj&auml;lv.&rdquo;</p>
                </div>
                <div class="book-tags">
                    <span class="book-tag">Konspirationer</span>
                    <span class="book-tag">Intellektuell</span>
                    <span class="book-tag">Episk</span>
                </div>
            </div>
        </div>

        <!-- Slakthus 5 -->
        <div class="book-card theme-vonnegut">
            <div class="book-card-accent"></div>
            <div class="book-card-body">
                <span class="book-genre">Klassiker &middot; Satir</span>
                <h3>Slakthus 5</h3>
                <p class="book-author">Kurt Vonnegut &nbsp;<span class="book-year">1969</span></p>
                <p class="book-description">
                    Billy Pilgrim har &rdquo;lossnat i tiden&rdquo; och kastas mellan bombningen av Dresden,
                    ett utomjordiskt zoo och efterkrigstidens Amerika. Vonneguts m&auml;sterverk &auml;r
                    p&aring; en g&aring;ng hilariskt roligt och outhärdligt sorgligt. &rdquo;So it goes.&rdquo;
                </p>
                <div class="book-quote">
                    <p>&rdquo;So it goes.&rdquo;</p>
                </div>
                <div class="book-tags">
                    <span class="book-tag">Antikrig</span>
                    <span class="book-tag">Tidsresor</span>
                    <span class="book-tag">Humor &amp; sorg</span>
                </div>
            </div>
        </div>

        <!-- Illusionisten -->
        <div class="book-card theme-fowles">
            <div class="book-card-accent"></div>
            <div class="book-card-body">
                <span class="book-genre">Litteratur &middot; Psykologisk</span>
                <h3>Illusionisten</h3>
                <p class="book-author">John Fowles &nbsp;<span class="book-year">1965</span></p>
                <p class="book-description">
                    En ung engelsman anl&auml;nder till en grekisk &ouml; och dras in i en mystisk miljon&auml;rs
                    elaborerade psykologiska spel. Ingenting &auml;r vad det verkar vara. En bok som vrider och v&auml;nder
                    p&aring; verkligheten tills man inte l&auml;ngre vet vad som &auml;r sant &mdash; och &auml;lskar det.
                </p>
                <div class="book-quote">
                    <p>&rdquo;An intelligent woman is a woman with whom one can be as stupid as one wants.&rdquo;</p>
                </div>
                <div class="book-tags">
                    <span class="book-tag">Psykologiskt spel</span>
                    <span class="book-tag">Grekland</span>
                    <span class="book-tag">Mystik</span>
                </div>
            </div>
        </div>

        <!-- Neuromancer -->
        <div class="book-card theme-gibson">
            <div class="book-card-accent"></div>
            <div class="book-card-body">
                <span class="book-genre">Cyberpunk &middot; Sci-fi</span>
                <h3>Neuromancer</h3>
                <p class="book-author">William Gibson &nbsp;<span class="book-year">1984</span></p>
                <p class="book-description">
                    Boken som uppfann cyberpunk. Case, en utbr&auml;nd hackare, f&aring;r en sista chans att
                    jaga sig in i cyberrymden och utf&ouml;ra det ultimata dataintrånget. Gibson m&aring;lade en framtid
                    som vi fortfarande lever oss in i &mdash; neonljus, AI och en v&auml;rld p&aring; kanten.
                </p>
                <div class="book-quote">
                    <p>&rdquo;The sky above the port was the color of television, tuned to a dead channel.&rdquo;</p>
                </div>
                <div class="book-tags">
                    <span class="book-tag">Cyberpunk-klassiker</span>
                    <span class="book-tag">Hackers</span>
                    <span class="book-tag">Vision&auml;rt</span>
                </div>
            </div>
        </div>

    </div>


</section>

<!-- ════════════════ FULL-PAGE BOOK PAGES ════════════════ -->
<div class="book-pages-container" id="bookPagesContainer">

    <!-- Page 1: Klara och Solen -->
    <div class="book-page active" data-page="0">
        <div class="book-page-inner">
            <div class="book-page-cover">
                <div class="cover-flipper">
                    <div class="cover-front"><div class="cover-mystery"><span class="mystery-icon">?</span><span class="mystery-label">Klassificerad</span></div></div>
                    <div class="cover-back"><img src="Böcker/klara och solen.webp" alt="Klara och Solen"></div>
                </div>
            </div>
            <div class="book-page-info redacted">
                <span class="page-label">// arkiv::bok_01</span>
                <span class="page-genre">Litteratur &middot; Sci-fi</span>
                <h2>Klara och Solen</h2>
                <p class="page-author">Kazuo Ishiguro <span class="page-year">2021</span></p>
                <button class="reveal-btn" onclick="revealBook(this)">Avsl&ouml;ja bok</button>
                <p class="page-description">
                    Ber&auml;ttad genom &ouml;gonen p&aring; Klara, en artificiell v&auml;n som observerar v&auml;rlden fr&aring;n ett skyltf&ouml;nster.
                    Med sin ovanliga blick avsl&ouml;jar hon vad det inneb&auml;r att &auml;lska, att vara ensam och att vara m&auml;nsklig.
                    Ishiguro skriver med en stillsam sk&ouml;nhet som sm&auml;lter hj&auml;rtat.
                </p>
                <div class="page-quote">
                    <p>&rdquo;Solen v&auml;rmde alltid n&aring;gon. Det var hennes s&auml;tt att visa v&auml;nlighet.&rdquo;</p>
                </div>
                <div class="page-tags">
                    <span class="page-tag">Nobelpristagare</span>
                    <span class="page-tag">AI &amp; m&auml;nsklighet</span>
                    <span class="page-tag">&Ouml;mhet</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Page 2: Exhalation -->
    <div class="book-page" data-page="1">
        <div class="book-page-inner">
            <div class="book-page-cover">
                <div class="cover-flipper">
                    <div class="cover-front"><div class="cover-mystery"><span class="mystery-icon">?</span><span class="mystery-label">Klassificerad</span></div></div>
                    <div class="cover-back"><img src="Böcker/exhalation.webp" alt="Exhalation"></div>
                </div>
            </div>
            <div class="book-page-info redacted">
                <span class="page-label">// arkiv::bok_02</span>
                <span class="page-genre">Sci-fi &middot; Noveller</span>
                <h2>Exhalation</h2>
                <p class="page-author">Ted Chiang <span class="page-year">2019</span></p>
                <button class="reveal-btn" onclick="revealBook(this)">Avsl&ouml;ja bok</button>
                <p class="page-description">
                    Nio noveller som utforskar fri vilja, tidens natur och vad det inneb&auml;r att vara medveten.
                    Ted Chiang skriver science fiction som f&aring;r en att stanna upp mitt i en mening och t&auml;nka:
                    &rdquo;S&aring; har jag aldrig sett p&aring; det f&ouml;rut.&rdquo; Varje ber&auml;ttelse &auml;r en liten juvel.
                </p>
                <div class="page-quote">
                    <p>&rdquo;The universe began as an enormous breath being held.&rdquo;</p>
                </div>
                <div class="page-tags">
                    <span class="page-tag">Tankeexperiment</span>
                    <span class="page-tag">Filosofisk sci-fi</span>
                    <span class="page-tag">Briljant</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Page 3: Foucaults pendel -->
    <div class="book-page" data-page="2">
        <div class="book-page-inner">
            <div class="book-page-cover">
                <div class="cover-flipper">
                    <div class="cover-front"><div class="cover-mystery"><span class="mystery-icon">?</span><span class="mystery-label">Klassificerad</span></div></div>
                    <div class="cover-back"><img src="Böcker/foucaults pendel.webp" alt="Foucaults pendel"></div>
                </div>
            </div>
            <div class="book-page-info redacted">
                <span class="page-label">// arkiv::bok_03</span>
                <span class="page-genre">Litteratur &middot; Mysterium</span>
                <h2>Foucaults pendel</h2>
                <p class="page-author">Umberto Eco <span class="page-year">1988</span></p>
                <button class="reveal-btn" onclick="revealBook(this)">Avsl&ouml;ja bok</button>
                <p class="page-description">
                    Tre f&ouml;rlagsredakt&ouml;rer hittar p&aring; en gigantisk konspiration f&ouml;r skojs skull &mdash;
                    tills den b&ouml;rjar bli verklig. En labyrintisk, intellektuell thriller som v&auml;ver samman
                    tempelriddare, kabbala och hemliga s&auml;llskap. F&ouml;r dig som &auml;lskar att g&aring; vilse i tankar.
                </p>
                <div class="page-quote">
                    <p>&rdquo;Jag tror att det finns ber&auml;ttelser som man bara kan ber&auml;tta f&ouml;r sig sj&auml;lv.&rdquo;</p>
                </div>
                <div class="page-tags">
                    <span class="page-tag">Konspirationer</span>
                    <span class="page-tag">Intellektuell</span>
                    <span class="page-tag">Episk</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Page 4: Slakthus 5 -->
    <div class="book-page" data-page="3">
        <div class="book-page-inner">
            <div class="book-page-cover">
                <div class="cover-flipper">
                    <div class="cover-front"><div class="cover-mystery"><span class="mystery-icon">?</span><span class="mystery-label">Klassificerad</span></div></div>
                    <div class="cover-back"><img src="Böcker/slakthus 5.webp" alt="Slakthus 5"></div>
                </div>
            </div>
            <div class="book-page-info redacted">
                <span class="page-label">// arkiv::bok_04</span>
                <span class="page-genre">Klassiker &middot; Satir</span>
                <h2>Slakthus 5</h2>
                <p class="page-author">Kurt Vonnegut <span class="page-year">1969</span></p>
                <button class="reveal-btn" onclick="revealBook(this)">Avsl&ouml;ja bok</button>
                <p class="page-description">
                    Billy Pilgrim har &rdquo;lossnat i tiden&rdquo; och kastas mellan bombningen av Dresden,
                    ett utomjordiskt zoo och efterkrigstidens Amerika. Vonneguts m&auml;sterverk &auml;r
                    p&aring; en g&aring;ng hilariskt roligt och outh&auml;rdligt sorgligt. &rdquo;So it goes.&rdquo;
                </p>
                <div class="page-quote">
                    <p>&rdquo;So it goes.&rdquo;</p>
                </div>
                <div class="page-tags">
                    <span class="page-tag">Antikrig</span>
                    <span class="page-tag">Tidsresor</span>
                    <span class="page-tag">Humor &amp; sorg</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Page 5: Illusionisten -->
    <div class="book-page" data-page="4">
        <div class="book-page-inner">
            <div class="book-page-cover">
                <div class="cover-flipper">
                    <div class="cover-front"><div class="cover-mystery"><span class="mystery-icon">?</span><span class="mystery-label">Klassificerad</span></div></div>
                    <div class="cover-back"><img src="Böcker/illusionisten.webp" alt="Illusionisten"></div>
                </div>
            </div>
            <div class="book-page-info redacted">
                <span class="page-label">// arkiv::bok_05</span>
                <span class="page-genre">Litteratur &middot; Psykologisk</span>
                <h2>Illusionisten</h2>
                <p class="page-author">John Fowles <span class="page-year">1965</span></p>
                <button class="reveal-btn" onclick="revealBook(this)">Avsl&ouml;ja bok</button>
                <p class="page-description">
                    En ung engelsman anl&auml;nder till en grekisk &ouml; och dras in i en mystisk miljon&auml;rs
                    elaborerade psykologiska spel. Ingenting &auml;r vad det verkar vara. En bok som vrider och v&auml;nder
                    p&aring; verkligheten tills man inte l&auml;ngre vet vad som &auml;r sant &mdash; och &auml;lskar det.
                </p>
                <div class="page-quote">
                    <p>&rdquo;An intelligent woman is a woman with whom one can be as stupid as one wants.&rdquo;</p>
                </div>
                <div class="page-tags">
                    <span class="page-tag">Psykologiskt spel</span>
                    <span class="page-tag">Grekland</span>
                    <span class="page-tag">Mystik</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Page 6: Neuromancer -->
    <div class="book-page" data-page="5">
        <div class="book-page-inner">
            <div class="book-page-cover">
                <div class="cover-flipper">
                    <div class="cover-front"><div class="cover-mystery"><span class="mystery-icon">?</span><span class="mystery-label">Klassificerad</span></div></div>
                    <div class="cover-back"><img src="Böcker/neuromancer.webp" alt="Neuromancer"></div>
                </div>
            </div>
            <div class="book-page-info redacted">
                <span class="page-label">// arkiv::bok_06</span>
                <span class="page-genre">Cyberpunk &middot; Sci-fi</span>
                <h2>Neuromancer</h2>
                <p class="page-author">William Gibson <span class="page-year">1984</span></p>
                <button class="reveal-btn" onclick="revealBook(this)">Avsl&ouml;ja bok</button>
                <p class="page-description">
                    Boken som uppfann cyberpunk. Case, en utbr&auml;nd hackare, f&aring;r en sista chans att
                    jaga sig in i cyberrymden och utf&ouml;ra det ultimata dataintr&aring;nget. Gibson m&aring;lade en framtid
                    som vi fortfarande lever oss in i &mdash; neonljus, AI och en v&auml;rld p&aring; kanten.
                </p>
                <div class="page-quote">
                    <p>&rdquo;The sky above the port was the color of television, tuned to a dead channel.&rdquo;</p>
                </div>
                <div class="page-tags">
                    <span class="page-tag">Cyberpunk-klassiker</span>
                    <span class="page-tag">Hackers</span>
                    <span class="page-tag">Vision&auml;rt</span>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Page Navigation -->
<div class="page-nav" id="pageNav">
    <button class="page-nav-btn" id="pagePrev">&#8592;</button>
    <div class="page-nav-dots" id="pageNavDots"></div>
    <span class="page-nav-counter" id="pageNavCounter">01 / 06</span>
    <button class="page-nav-btn" id="pageNext">&#8594;</button>
    <button class="page-nav-vote-btn" id="goToVoteBtn">Vidare &#9658;</button>
</div>

<!-- Background music -->
<audio id="bgMusic" src="musik.mp3" preload="auto" loop></audio>

<!-- Glitch overlay elements -->
<div class="glitch-overlay" id="glitchOverlay">
    <div class="glitch-bar"></div>
    <div class="glitch-bar" style="animation-delay: 0.1s"></div>
    <div class="glitch-bar" style="animation-delay: 0.2s"></div>
    <div class="glitch-block"></div>
    <div class="glitch-block" style="animation-delay: 0.15s"></div>
</div>
<div class="glitch-text-overlay" id="glitchText">
    <span class="glitch-msg">SYSTEM OVERRIDE</span>
</div>

<!-- ════════════════ ROBOT GAME ════════════════ -->
<div class="robot-game-overlay" id="robotGameOverlay">
    <div class="robot-game-hud">
        <div class="hud-player" id="hudPlayer"></div>
        <div class="hud-timer" id="hudTimer">10</div>
        <div class="hud-score" id="hudScore">0</div>
    </div>
    <canvas id="robotGameCanvas"></canvas>

    <!-- Pre-game video -->
    <div class="game-video-screen" id="gameVideoScreen1">
        <video id="gameVideo1" src="film_1.mp4" playsinline></video>
    </div>

    <!-- Post-game video -->
    <div class="game-video-screen" id="gameVideoScreen2" style="display:none;">
        <video id="gameVideo2" src="film_2.mp4" playsinline></video>
    </div>

    <div class="game-start-screen" id="gameStartScreen" style="display:none;">
        <h2>Robot Race</h2>
        <p>Flyg din robot genom hindren! Tryck upp&aring;t eller mellanslag f&ouml;r att ge gas. Undvik hindren och samla po&auml;ng i 10 sekunder.</p>
        <div class="player-up" id="gamePlayerUp"></div>
        <button class="game-start-btn" id="gameStartBtn">K&ouml;r!</button>
    </div>

    <div class="game-scores-screen" id="gameScoresScreen" style="display:none;">
        <h2>Resultat</h2>
        <ul class="score-list" id="gameScoreList"></ul>
        <button class="game-next-btn" id="gameNextBtn"></button>
    </div>
</div>

<!-- ════════════════ VOTING ════════════════ -->
<section id="voting">
    <div class="section-header">
        <h2>R&ouml;stningen</h2>
        <p>Tre rundor. Varje runda v&auml;ljer alla sina favoriter &mdash; b&ouml;ckerna med f&auml;rst r&ouml;ster sl&aring;s ut.</p>
    </div>

    <div class="voting-container">
        <div class="steps-indicator" id="stepsIndicator"></div>

        <div class="robot-panel" id="robotPanel"></div>

        <div class="voter-select-panel">
            <label>Vem r&ouml;star?</label>
            <div class="voter-buttons" id="voterButtons"></div>
        </div>

        <p class="vote-instruction" id="voteInstruction"></p>

        <div class="vote-options" id="voteOptions"></div>

        <button class="vote-submit-btn" id="submitVoteBtn" disabled>R&ouml;sta</button>

        <div class="results-panel" id="resultsPanel"></div>
        <div class="winner-panel" id="winnerPanel">
            <div class="winner-trophy">&#9733;</div>
            <p>Bokcirkeln har valt</p>
            <div class="winner-book-title" id="winnerTitle"></div>
            <div class="winner-book-author" id="winnerAuthor"></div>
            <div class="winner-robots" id="winnerRobots"></div>
            <h3>Grattis &mdash; vi har en bok!</h3>
        </div>

        <div style="text-align:center;">
            <button class="reset-btn" id="resetBtn">&#8634; B&ouml;rja om fr&aring;n scratch</button>
        </div>
    </div>
</section>

<!-- ════════════════ FOOTER ════════════════ -->
<footer>
    <p>Bokcirkeln 2026 &mdash; gjord med <span>&hearts;</span> f&ouml;r b&ouml;cker och v&auml;nskap</p>
</footer>

<script>
function revealBook(btn) {
    const page = btn.closest('.book-page');
    // Flip the cover
    page.querySelector('.book-page-cover').classList.add('revealed');
    // Remove redacted, add reveal animation
    const info = page.querySelector('.book-page-info');
    info.classList.remove('redacted');
    info.classList.add('revealing');
    // Hide button
    btn.classList.add('hidden');
}

(function() {
    'use strict';

    // ── Book data ──
    const BOOKS = [
        { id: 'ishiguro', title: 'Klara och Solen', author: 'Kazuo Ishiguro' },
        { id: 'chiang', title: 'Exhalation', author: 'Ted Chiang' },
        { id: 'eco', title: 'Foucaults pendel', author: 'Umberto Eco' },
        { id: 'vonnegut', title: 'Slakthus 5', author: 'Kurt Vonnegut' },
        { id: 'fowles', title: 'Illusionisten', author: 'John Fowles' },
        { id: 'gibson', title: 'Neuromancer', author: 'William Gibson' }
    ];

    const MEMBERS = ['Jonas', 'Jessan', 'Josse', 'Bulf', 'Emilie'];

    // Robot image paths per member and expression
    const ROBOT_IMAGES = {
        Jonas:  { neutral: 'Robotar/jonas.webp', glad: 'Robotar/jonas.webp', ledsen: 'Robotar/jonas.webp', radd: 'Robotar/jonas.webp', lys: 'Robotar/jonas_lys.webp' },
        Jessan: { neutral: 'Robotar/jessan.webp', glad: 'Robotar/jessan_glad.webp', ledsen: 'Robotar/jessan_ledsen.webp', radd: 'Robotar/jessan_r\u00e4dd.webp' },
        Josse:  { neutral: 'Robotar/josse.webp', glad: 'Robotar/josse_glad.webp', ledsen: 'Robotar/josse_ledsen.png', radd: 'Robotar/josse_r\u00e4dd.webp' },
        Bulf:   { neutral: 'Robotar/bulf.png', glad: 'Robotar/bulf_glad.webp', ledsen: 'Robotar/bulf_ledsen.webp', radd: 'Robotar/bulf_r\u00e4dd.webp' },
        Emilie: { neutral: 'Robotar/emilie.webp', glad: 'Robotar/emilie_glad.webp', ledsen: 'Robotar/emilie_ledsen.webp', radd: 'Robotar/emilie_r\u00e4dd.png' }
    };

    // How many picks per round (round 1 = pick 3, round 2 = pick 2, round 3 = pick 1)
    const PICKS_PER_ROUND = [3, 2, 1];
    const TOTAL_ROUNDS = 3;

    // ── State ──
    let state = loadState() || createFreshState();
    if (!state.robotMood) state.robotMood = {};
    if (!state.selectedBooks) state.selectedBooks = [];

    function createFreshState() {
        return {
            currentRound: 0,
            rounds: [],
            eliminatedBooks: [],
            selectedVoter: null,
            selectedBooks: [],
            finished: false,
            winner: null,
            lastEliminated: [],
            robotMood: {}
        };
    }

    function loadState() {
        try {
            const saved = localStorage.getItem('bookclub_vote_state_v2');
            return saved ? JSON.parse(saved) : null;
        } catch(e) { return null; }
    }

    function saveState() {
        try {
            localStorage.setItem('bookclub_vote_state_v2', JSON.stringify(state));
        } catch(e) {}
    }

    function getCurrentPicks() {
        return PICKS_PER_ROUND[state.currentRound] || 1;
    }

    function getCurrentRoundData() {
        if (!state.rounds[state.currentRound]) {
            state.rounds[state.currentRound] = { votes: {} };
        }
        return state.rounds[state.currentRound];
    }

    function getActiveBooks() {
        return BOOKS.filter(b => !state.eliminatedBooks.includes(b.id));
    }

    function getRoundVoters() {
        const round = getCurrentRoundData();
        return MEMBERS.filter(m => round.votes[m] !== undefined);
    }

    function allVoted() {
        return getRoundVoters().length === MEMBERS.length;
    }

    // ── Determine robot expression ──
    function getRobotExpression(name) {
        if (state.robotMood && state.robotMood[name]) return state.robotMood[name];
        return 'neutral';
    }

    function getRobotImage(name) {
        const expr = getRobotExpression(name);
        const images = ROBOT_IMAGES[name];
        if (name === 'Jonas' && expr === 'glad') return images.lys;
        return images[expr] || images.neutral;
    }

    // ── Render robot panel ──
    function renderRobots() {
        const panel = document.getElementById('robotPanel');
        panel.innerHTML = '';
        const roundVoters = getRoundVoters();

        MEMBERS.forEach(name => {
            const avatar = document.createElement('div');
            avatar.className = 'robot-avatar';
            const hasVoted = roundVoters.includes(name);
            const isVoting = state.selectedVoter === name && !hasVoted;

            if (isVoting) avatar.classList.add('voting-now');
            if (hasVoted) avatar.classList.add('has-voted');

            const expr = getRobotExpression(name);
            const speech = document.createElement('div');
            speech.className = 'robot-speech';

            if (state.finished) {
                speech.textContent = '';
            } else if (isVoting) {
                speech.textContent = 'Hmm...';
            } else if (hasVoted && !allVoted()) {
                speech.textContent = 'Klar!';
            }

            avatar.innerHTML = `
                <div class="robot-img-wrap">
                    <img src="${getRobotImage(name)}" alt="${name}">
                </div>
                <span class="robot-name">${name}</span>
            `;
            avatar.appendChild(speech);
            panel.appendChild(avatar);
        });
    }

    // ── Render steps ──
    function renderSteps() {
        const container = document.getElementById('stepsIndicator');
        container.innerHTML = '';
        const roundLabels = ['Runda 1 \u2014 v\u00e4lj 3', 'Runda 2 \u2014 v\u00e4lj 2', 'Runda 3 \u2014 v\u00e4lj 1'];
        for (let i = 0; i < TOTAL_ROUNDS; i++) {
            const dot = document.createElement('div');
            dot.className = 'step-dot';
            if (i === state.currentRound && !state.finished) dot.classList.add('active');
            if (i < state.currentRound) dot.classList.add('completed');
            dot.innerHTML = `<span class="step-num">${i + 1}</span> ${roundLabels[i]}`;
            container.appendChild(dot);
        }
    }

    // ── Render voter buttons ──
    function renderVoterButtons() {
        const container = document.getElementById('voterButtons');
        container.innerHTML = '';
        const roundVoters = getRoundVoters();
        MEMBERS.forEach(name => {
            const btn = document.createElement('button');
            btn.className = 'voter-btn';
            const hasVoted = roundVoters.includes(name);
            if (hasVoted) btn.classList.add('has-voted');
            if (state.selectedVoter === name) btn.classList.add('selected');
            btn.innerHTML = `${name}<span class="check"> \u2713</span>`;
            btn.addEventListener('click', () => {
                state.selectedVoter = name;
                state.selectedBooks = [];
                saveState();
                render();
            });
            container.appendChild(btn);
        });
    }

    // ── Render vote options (multi-select) ──
    function renderVoteOptions() {
        const container = document.getElementById('voteOptions');
        const instruction = document.getElementById('voteInstruction');
        const submitBtn = document.getElementById('submitVoteBtn');
        container.innerHTML = '';

        if (state.finished) {
            container.classList.add('hidden');
            submitBtn.classList.add('hidden');
            instruction.textContent = '';
            return;
        }

        container.classList.remove('hidden');
        submitBtn.classList.remove('hidden');

        const picks = getCurrentPicks();

        if (!state.selectedVoter) {
            instruction.innerHTML = 'V\u00e4lj ditt namn ovan f\u00f6r att r\u00f6sta.';
            submitBtn.disabled = true;
            getActiveBooks().forEach(book => {
                const opt = createVoteOption(book, true);
                container.appendChild(opt);
            });
            return;
        }

        const round = getCurrentRoundData();
        const hasVoted = round.votes[state.selectedVoter] !== undefined;

        if (hasVoted && !allVoted()) {
            instruction.innerHTML = `<strong>${state.selectedVoter}</strong> har r\u00f6stat! V\u00e4nta p\u00e5 att alla ska r\u00f6sta.`;
            submitBtn.disabled = true;
            getActiveBooks().forEach(book => {
                const opt = createVoteOption(book, true);
                container.appendChild(opt);
            });
            return;
        }

        if (allVoted()) {
            instruction.innerHTML = 'Alla har r\u00f6stat! Tryck f\u00f6r att se resultatet.';
            submitBtn.disabled = false;
            submitBtn.textContent = 'Visa resultat';
            container.classList.add('hidden');
            // Everyone nervous before reveal!
            MEMBERS.forEach(m => { state.robotMood[m] = 'radd'; });
            renderRobots();
            return;
        }

        instruction.innerHTML = `<strong>${state.selectedVoter}</strong>, v\u00e4lj dina <strong>${picks}</strong> favoriter:`;
        submitBtn.textContent = 'R\u00f6sta';

        getActiveBooks().forEach(book => {
            const opt = createVoteOption(book, false);
            container.appendChild(opt);
        });

        submitBtn.disabled = state.selectedBooks.length !== picks;
    }

    function createVoteOption(book, disabled) {
        const opt = document.createElement('div');
        opt.className = 'vote-option';
        const isSelected = state.selectedBooks.includes(book.id);
        if (isSelected) opt.classList.add('selected');
        opt.innerHTML = `
            <div class="vote-radio"><div class="vote-radio-inner"></div></div>
            <div class="vote-option-info">
                <div class="vote-option-title">${book.title}</div>
                <div class="vote-option-author">${book.author}</div>
            </div>
        `;
        if (!disabled) {
            opt.addEventListener('click', () => {
                const picks = getCurrentPicks();
                const idx = state.selectedBooks.indexOf(book.id);
                if (idx >= 0) {
                    state.selectedBooks.splice(idx, 1);
                } else if (state.selectedBooks.length < picks) {
                    state.selectedBooks.push(book.id);
                } else {
                    // Replace oldest selection
                    state.selectedBooks.shift();
                    state.selectedBooks.push(book.id);
                }
                saveState();
                render();
            });
        } else {
            opt.style.cursor = 'default';
        }
        return opt;
    }

    // ── Submit vote ──
    function handleSubmit() {
        if (state.finished) return;

        if (allVoted()) {
            processRound();
            return;
        }

        if (!state.selectedVoter) return;
        const picks = getCurrentPicks();
        if (state.selectedBooks.length !== picks) return;

        const round = getCurrentRoundData();
        if (round.votes[state.selectedVoter] !== undefined) return;

        round.votes[state.selectedVoter] = [...state.selectedBooks];
        state.selectedBooks = [];

        saveState();
        render();
    }

    // ── Process round ──
    function processRound() {
        const round = getCurrentRoundData();
        const activeBooks = getActiveBooks();

        // Count votes (each member voted for multiple books)
        const counts = {};
        activeBooks.forEach(b => counts[b.id] = 0);
        Object.values(round.votes).forEach(bookIds => {
            bookIds.forEach(bookId => {
                counts[bookId] = (counts[bookId] || 0) + 1;
            });
        });

        round.counts = counts;

        // Determine how many to eliminate this round
        // Round 1: 6 books -> pick 3 -> eliminate bottom books to get to 4
        // Round 2: 4 books -> pick 2 -> eliminate bottom books to get to 2
        // Round 3: 2 books -> pick 1 -> eliminate bottom to get winner
        const targetRemaining = state.currentRound === 0 ? 4 : state.currentRound === 1 ? 2 : 1;
        const toEliminate = activeBooks.length - targetRemaining;

        // Sort by votes ascending to find the books to eliminate
        const sorted = Object.entries(counts).sort((a, b) => a[1] - b[1]);
        const eliminated = sorted.slice(0, toEliminate).map(e => e[0]);

        eliminated.forEach(id => state.eliminatedBooks.push(id));
        round.eliminated = eliminated;
        state.lastEliminated = eliminated;

        // Update robot moods based on results
        const newMood = {};
        MEMBERS.forEach(name => {
            const memberVotes = round.votes[name] || [];
            const lostAFav = memberVotes.some(id => eliminated.includes(id));
            const keptAll = memberVotes.every(id => !eliminated.includes(id));

            if (lostAFav) {
                newMood[name] = 'ledsen';
            } else if (keptAll) {
                newMood[name] = 'glad';
            } else {
                newMood[name] = 'neutral';
            }
        });
        state.robotMood = newMood;

        // Check if we have a winner
        const remaining = getActiveBooks();
        if (remaining.length === 1) {
            state.finished = true;
            state.winner = remaining[0];
            // Everyone happy for the winner!
            MEMBERS.forEach(name => { state.robotMood[name] = 'glad'; });
        } else {
            state.currentRound++;
        }

        state.selectedVoter = null;
        state.selectedBooks = [];
        saveState();
        render();
        renderResults();
    }

    // ── Render results ──
    function renderResults() {
        const panel = document.getElementById('resultsPanel');
        panel.innerHTML = '';

        const completedRounds = state.rounds.filter(r => r && r.counts);
        if (completedRounds.length === 0) {
            panel.classList.remove('visible');
            return;
        }

        panel.classList.add('visible');
        const roundLabels = ['Runda 1', 'Runda 2', 'Runda 3'];

        completedRounds.forEach((round, i) => {
            const div = document.createElement('div');
            div.className = 'round-result';

            let html = `<h4>${roundLabels[i]}</h4>`;

            // Sort by votes descending
            const sorted = Object.entries(round.counts).sort((a, b) => b[1] - a[1]);
            const maxVotes = Math.max(...sorted.map(s => s[1]));

            sorted.forEach(([bookId, votes]) => {
                const book = BOOKS.find(b => b.id === bookId);
                const isEliminated = round.eliminated.includes(bookId);
                const pct = maxVotes > 0 ? (votes / (MEMBERS.length * PICKS_PER_ROUND[i])) * 100 : 0;
                html += `
                    <div class="result-bar-container ${isEliminated ? 'eliminated' : ''}">
                        <div class="result-bar-label">
                            <span>${book.title} ${isEliminated ? '(eliminerad)' : ''}</span>
                            <span>${votes} r\u00f6st${votes !== 1 ? 'er' : ''}</span>
                        </div>
                        <div class="result-bar">
                            <div class="result-bar-fill" style="width: ${Math.min(pct, 100)}%"></div>
                        </div>
                    </div>
                `;
            });

            div.innerHTML = html;
            panel.appendChild(div);
        });

        requestAnimationFrame(() => {
            panel.querySelectorAll('.result-bar-fill').forEach(bar => {
                bar.style.width = bar.style.width;
            });
        });
    }

    // ── Render winner ──
    function renderWinner() {
        const panel = document.getElementById('winnerPanel');
        if (state.finished && state.winner) {
            panel.classList.add('visible');
            document.getElementById('winnerTitle').textContent = state.winner.title;
            document.getElementById('winnerAuthor').textContent = state.winner.author;
            document.getElementById('submitVoteBtn').classList.add('hidden');

            // Show all robots happy
            const robotsContainer = document.getElementById('winnerRobots');
            robotsContainer.innerHTML = '';
            MEMBERS.forEach(name => {
                const wrap = document.createElement('div');
                wrap.className = 'robot-img-wrap';
                wrap.innerHTML = `<img src="${ROBOT_IMAGES[name].glad || ROBOT_IMAGES[name].neutral}" alt="${name}">`;
                if (name === 'Jonas') wrap.innerHTML = `<img src="${ROBOT_IMAGES[name].lys}" alt="${name}">`;
                robotsContainer.appendChild(wrap);
            });
        } else {
            panel.classList.remove('visible');
        }
    }

    // ── Master render ──
    function render() {
        renderSteps();
        renderRobots();
        renderVoterButtons();
        renderVoteOptions();
        renderResults();
        renderWinner();
    }

    // ── Reset ──
    document.getElementById('resetBtn').addEventListener('click', () => {
        if (confirm('\u00c4r du s\u00e4ker p\u00e5 att du vill b\u00f6rja om helt?')) {
            state = createFreshState();
            saveState();
            render();
        }
    });

    // ── Submit ──
    document.getElementById('submitVoteBtn').addEventListener('click', handleSubmit);

    // ── Scroll animations ──
    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry, i) => {
            if (entry.isIntersecting) {
                setTimeout(() => entry.target.classList.add('visible'), i * 100);
                observer.unobserve(entry.target);
            }
        });
    }, { threshold: 0.1 });

    document.querySelectorAll('.book-card').forEach(card => observer.observe(card));

    // ── Floating particles ──
    const symbols = ['\u2726', '\u2727', '\u2605', '\u2022', '\u25cf', '\u2736'];
    const particleContainer = document.getElementById('particles');
    for (let i = 0; i < 20; i++) {
        const p = document.createElement('span');
        p.className = 'particle';
        p.textContent = symbols[Math.floor(Math.random() * symbols.length)];
        p.style.left = Math.random() * 100 + '%';
        p.style.animationDuration = (15 + Math.random() * 25) + 's';
        p.style.animationDelay = (Math.random() * 20) + 's';
        p.style.fontSize = (0.6 + Math.random() * 1.2) + 'rem';
        particleContainer.appendChild(p);
    }

    // ── Init ──
    render();

    // ═══════════════════════════════════════════
    // DYSTOPIAN GLITCH TRANSITION & BOOK PAGES
    // ═══════════════════════════════════════════

    let currentPage = 0;
    let isDystopian = false;
    const totalPages = 6;

    // Build navigation dots
    function buildPageNav() {
        const dotsContainer = document.getElementById('pageNavDots');
        dotsContainer.innerHTML = '';
        for (let i = 0; i < totalPages; i++) {
            const dot = document.createElement('div');
            dot.className = 'page-nav-dot' + (i === 0 ? ' active' : '');
            dot.addEventListener('click', () => goToPage(i));
            dotsContainer.appendChild(dot);
        }
        updatePageCounter();
    }

    function goToPage(index) {
        if (index < 0) index = totalPages - 1;
        if (index >= totalPages) index = 0;

        const pages = document.querySelectorAll('.book-page');
        const dots = document.querySelectorAll('.page-nav-dot');

        pages.forEach(p => p.classList.remove('active'));
        dots.forEach(d => d.classList.remove('active'));

        currentPage = index;
        pages[currentPage].classList.add('active');
        dots[currentPage].classList.add('active');
        updatePageCounter();
    }

    function updatePageCounter() {
        const counter = document.getElementById('pageNavCounter');
        counter.textContent = String(currentPage + 1).padStart(2, '0') + ' / ' + String(totalPages).padStart(2, '0');
    }

    document.getElementById('pagePrev').addEventListener('click', () => goToPage(currentPage - 1));
    document.getElementById('pageNext').addEventListener('click', () => goToPage(currentPage + 1));

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
        if (!isDystopian) return;
        if (e.key === 'ArrowLeft') goToPage(currentPage - 1);
        if (e.key === 'ArrowRight') goToPage(currentPage + 1);
    });

    // Phase 1: Glitch transition to dystopian background only
    function triggerDystopianTransition() {
        if (isDystopian) return;
        isDystopian = true;

        const overlay = document.getElementById('glitchOverlay');
        const textOverlay = document.getElementById('glitchText');

        // Play warning sound
        const warnSfx = new Audio('warning.wav');
        warnSfx.play().catch(() => {});

        // Start glitch
        overlay.classList.add('active');
        textOverlay.classList.add('active');
        document.body.classList.add('screen-shake');

        // Start music
        const music = document.getElementById('bgMusic');
        music.currentTime = 0;
        music.play().catch(() => {});

        // Remove screen shake
        setTimeout(() => {
            document.body.classList.remove('screen-shake');
        }, 400);

        // Swap theme halfway through the glitch (background only, no books yet)
        setTimeout(() => {
            document.body.classList.add('dystopian');
            // Hide the first button, show the enter button
            document.getElementById('exploreBooksBtn').style.display = 'none';
            const enterBtn = document.getElementById('enterBooksBtn');
            enterBtn.style.display = '';
            enterBtn.style.opacity = '0';
            enterBtn.style.animation = 'fadeInUp 0.8s ease forwards 0.3s';
        }, 900);

        // Clean up glitch overlays
        setTimeout(() => {
            overlay.classList.remove('active');
            textOverlay.classList.remove('active');
        }, 2000);
    }

    // Phase 2: Show the books
    function showBooks() {
        document.getElementById('bookPagesContainer').classList.add('active');
        document.getElementById('pageNav').classList.add('active');
        buildPageNav();
        document.body.style.overflow = 'hidden';
        document.getElementById('enterBooksBtn').style.display = 'none';
    }

    // First click: glitch to dystopian background
    document.getElementById('exploreBooksBtn').addEventListener('click', (e) => {
        e.preventDefault();
        triggerDystopianTransition();
    });

    // Second click: mini-glitch then open the books
    document.getElementById('enterBooksBtn').addEventListener('click', (e) => {
        e.preventDefault();
        const overlay = document.getElementById('glitchOverlay');
        overlay.classList.add('active');
        document.body.classList.add('screen-shake');
        setTimeout(() => document.body.classList.remove('screen-shake'), 400);
        setTimeout(() => {
            overlay.classList.remove('active');
            showBooks();
        }, 800);
    });

    // Go to game – close book pages and launch robot game
    document.getElementById('goToVoteBtn').addEventListener('click', () => {
        document.getElementById('bookPagesContainer').classList.remove('active');
        document.getElementById('pageNav').classList.remove('active');
        startRobotGame();
    });

    // ── Robot Flying Game ──
    function startRobotGame() {
        const overlay = document.getElementById('robotGameOverlay');
        const canvas = document.getElementById('robotGameCanvas');
        const ctx = canvas.getContext('2d');
        const startScreen = document.getElementById('gameStartScreen');
        const scoresScreen = document.getElementById('gameScoresScreen');
        const videoScreen1 = document.getElementById('gameVideoScreen1');
        const videoScreen2 = document.getElementById('gameVideoScreen2');
        const video1 = document.getElementById('gameVideo1');
        const video2 = document.getElementById('gameVideo2');

        const players = [...MEMBERS];
        let playerIndex = 0;
        const scores = {};

        // Preload images
        const imgBody = new Image();
        imgBody.src = 'robotkropp.webp';
        const imgBodyGas = new Image();
        imgBodyGas.src = 'robotkropp_gas.webp';
        const headImages = {};
        players.forEach(name => {
            const img = new Image();
            img.src = ROBOT_IMAGES[name].neutral;
            headImages[name] = img;
        });

        overlay.classList.add('active');

        // ── Phase 1: Play film_1 first ──
        videoScreen1.style.display = '';
        video1.play();
        video1.onended = () => {
            videoScreen1.style.display = 'none';
            showPlayerStart();
        };
        // Click to skip
        videoScreen1.onclick = () => {
            video1.pause();
            video1.onended = null;
            videoScreen1.style.display = 'none';
            showPlayerStart();
        };

        function showPlayerStart() {
            startScreen.style.display = '';
            scoresScreen.style.display = 'none';
            videoScreen2.style.display = 'none';
            const pName = players[playerIndex];
            document.getElementById('gamePlayerUp').textContent = pName + (pName.endsWith('s') ? ' tur!' : 's tur!');
            document.getElementById('gameStartBtn').textContent = 'Kör!';
        }

        document.getElementById('gameStartBtn').onclick = () => {
            startScreen.style.display = 'none';
            runGame(players[playerIndex]);
        };

        // ── Shared world state (persists across players) ──
        let worldOffset = 0;         // how far the camera has scrolled in world coords
        let worldObstacles = [];     // pillars in world coords
        let worldBalls = [];         // flying ball hazards in world coords
        let worldNextSpawnX = 0;     // next obstacle spawn x in world
        let W, H;
        let robotW, robotBodyH, robotHeadH, totalRobotH;
        let obstW, gapSize, obstSpeed, obstSpacing;
        let initialized = false;

        // Positions of waiting players in world coords
        let waitingPlayers = [];

        function initWorld() {
            W = canvas.width;
            H = canvas.height;
            robotW = Math.min(70, W * 0.09);
            robotBodyH = robotW * 1.4;
            robotHeadH = robotW * 1.0;
            totalRobotH = robotBodyH + robotHeadH * 0.55;
            obstW = Math.min(55, W * 0.07);
            gapSize = totalRobotH * 3.2;
            obstSpeed = Math.max(3, W * 0.004);
            obstSpacing = W * 0.45;

            // Place future players along the course
            // Distance per 10 seconds: obstSpeed * ~600 frames (60fps * 10s)
            const playerSpacing = obstSpeed * 600;
            waitingPlayers = [];
            for (let i = 1; i < players.length; i++) {
                waitingPlayers.push({
                    name: players[i],
                    worldX: i * playerSpacing,
                    y: H / 2,
                    active: false
                });
            }

            // Pre-generate some initial obstacles
            worldNextSpawnX = W * 0.6;
            for (let i = 0; i < 15; i++) {
                spawnObstacle();
            }
            initialized = true;
        }

        function spawnObstacle() {
            const minGapY = gapSize / 2 + 40;
            const maxGapY = H - gapSize / 2 - 40;
            const gapY = minGapY + Math.random() * (maxGapY - minGapY);
            worldObstacles.push({ worldX: worldNextSpawnX, gapY, hit: false });
            // Possibly spawn a ball hazard near this obstacle
            if (Math.random() < 0.4) {
                const ballY = minGapY + Math.random() * (maxGapY - minGapY);
                const ballSpeedY = (Math.random() - 0.5) * 2;
                worldBalls.push({
                    worldX: worldNextSpawnX + obstSpacing * 0.5,
                    y: ballY,
                    vy: ballSpeedY,
                    radius: 10 + Math.random() * 8,
                    hit: false
                });
            }
            worldNextSpawnX += obstSpacing;
        }

        function runGame(playerName) {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (!initialized) initWorld();
            W = canvas.width;
            H = canvas.height;

            document.getElementById('hudPlayer').textContent = playerName;

            const robotScreenX = W * 0.18;
            let robotY = H / 2;
            let velocity = 0;
            const gravity = 0.45;
            const flapStrength = -7;

            let score = 10;
            let timeLeft = 10.0;
            let thrusting = false;

            // Handoff state
            let handoff = false;
            let handoffTimer = 0;
            const handoffDuration = 90;

            // Input
            const keys = {};
            function onKeyDown(e) {
                if (e.code === 'ArrowUp' || e.code === 'Space' || e.code === 'KeyW') {
                    e.preventDefault();
                    keys.up = true;
                }
            }
            function onKeyUp(e) {
                if (e.code === 'ArrowUp' || e.code === 'Space' || e.code === 'KeyW') {
                    keys.up = false;
                }
            }
            function onTouchStart(e) { e.preventDefault(); keys.up = true; }
            function onTouchEnd() { keys.up = false; }
            window.addEventListener('keydown', onKeyDown);
            window.addEventListener('keyup', onKeyUp);
            canvas.addEventListener('touchstart', onTouchStart);
            canvas.addEventListener('touchend', onTouchEnd);

            let lastTime = performance.now();

            function update(now) {
                const dt = Math.min((now - lastTime) / 16.67, 2);
                lastTime = now;

                // Handoff animation
                if (handoff) {
                    handoffTimer += dt;
                    // Keep scrolling during handoff
                    worldOffset += obstSpeed * dt;
                    if (handoffTimer >= handoffDuration) {
                        cleanup();
                        scores[playerName] = score;
                        playerIndex++;
                        if (playerIndex < players.length) {
                            runGame(players[playerIndex]);
                        } else {
                            showScores();
                        }
                        return 'done';
                    }
                    return;
                }

                // Timer
                timeLeft -= dt * (16.67 / 1000);
                if (timeLeft <= 0) {
                    timeLeft = 0;
                    handoff = true;
                    handoffTimer = 0;
                    keys.up = false;
                    return;
                }
                document.getElementById('hudTimer').textContent = Math.ceil(timeLeft);
                document.getElementById('hudScore').textContent = score + ' p';

                // Physics
                thrusting = !!keys.up;
                if (thrusting) {
                    velocity += (flapStrength * 0.15) * dt;
                }
                velocity += gravity * dt;
                velocity = Math.max(-10, Math.min(10, velocity));
                robotY += velocity * dt;

                if (robotY < totalRobotH / 2) { robotY = totalRobotH / 2; velocity = 0; }
                if (robotY > H - robotBodyH / 2) { robotY = H - robotBodyH / 2; velocity = 0; }

                // Scroll world
                worldOffset += obstSpeed * dt;

                // Ensure enough obstacles ahead
                while (worldNextSpawnX < worldOffset + W * 2) {
                    spawnObstacle();
                }

                // Robot world X
                const robotWorldX = worldOffset + robotScreenX;

                // Check if we reached the next waiting player → handoff
                for (const wp of waitingPlayers) {
                    if (!wp.active && wp.name !== playerName && robotWorldX >= wp.worldX - robotW) {
                        handoff = true;
                        handoffTimer = 0;
                        keys.up = false;
                        return;
                    }
                }

                // Obstacle collision
                for (const o of worldObstacles) {
                    const screenX = o.worldX - worldOffset;
                    if (screenX > W + 100 || screenX + obstW < -100) continue;

                    const rLeft = robotScreenX - robotW / 2;
                    const rRight = robotScreenX + robotW / 2;
                    const rTop = robotY - totalRobotH / 2;
                    const rBottom = robotY + robotBodyH / 2;

                    if (rRight > screenX && rLeft < screenX + obstW) {
                        if (rTop < o.gapY - gapSize / 2 || rBottom > o.gapY + gapSize / 2) {
                            velocity = 0;
                            if (rTop < o.gapY - gapSize / 2) {
                                robotY = o.gapY - gapSize / 2 + totalRobotH / 2 + 2;
                            } else {
                                robotY = o.gapY + gapSize / 2 - robotBodyH / 2 - 2;
                            }
                            if (!o.hit) {
                                o.hit = true;
                                score--;
                            }
                        }
                    }
                }

                // Ball hazards: move and collide
                for (const b of worldBalls) {
                    b.y += b.vy * dt;
                    if (b.y < b.radius + 20 || b.y > H - b.radius - 20) b.vy *= -1;

                    const screenX = b.worldX - worldOffset;
                    if (screenX > W + 100 || screenX < -100) continue;

                    const dx = robotScreenX - screenX;
                    const dy = robotY - b.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < b.radius + robotW * 0.4 && !b.hit) {
                        b.hit = true;
                        score--;
                        // Knock robot
                        velocity += (dy > 0 ? 3 : -3);
                    }
                }

                // Reset ball hit flags once far past
                for (const b of worldBalls) {
                    if (b.hit) {
                        const screenX = b.worldX - worldOffset;
                        if (screenX < robotScreenX - W * 0.3) b.hit = false;
                    }
                }
            }

            function drawRobot(x, y, name, isThrust, tiltAngle) {
                const bodyImg = isThrust ? imgBodyGas : imgBody;
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(tiltAngle);

                // Draw body
                if (bodyImg.complete && bodyImg.naturalWidth) {
                    ctx.drawImage(bodyImg, -robotW / 2, -robotBodyH * 0.2, robotW, robotBodyH);
                }

                // Draw head (shifted right to match body)
                const headImg = headImages[name];
                const headOffsetX = robotW * 0.12;
                if (headImg && headImg.complete && headImg.naturalWidth) {
                    ctx.drawImage(headImg, -robotW / 2 + headOffsetX, -robotBodyH * 0.2 - robotHeadH * 0.55, robotW, robotHeadH);
                } else {
                    ctx.fillStyle = '#ff3355';
                    ctx.beginPath();
                    ctx.arc(headOffsetX, -robotBodyH * 0.2 - robotHeadH * 0.2, robotW * 0.35, 0, Math.PI * 2);
                    ctx.fill();
                }

                // Thrust particles
                if (isThrust) {
                    for (let i = 0; i < 4; i++) {
                        const px = (Math.random() - 0.5) * robotW * 0.5;
                        const py = robotBodyH * 0.7 + Math.random() * 15;
                        const size = 2 + Math.random() * 4;
                        ctx.fillStyle = `rgba(255, ${50 + Math.random() * 100 | 0}, 0, ${0.5 + Math.random() * 0.5})`;
                        ctx.beginPath();
                        ctx.arc(px, py, size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
                ctx.restore();
            }

            function draw() {
                ctx.clearRect(0, 0, W, H);

                ctx.fillStyle = '#0a0a0a';
                ctx.fillRect(0, 0, W, H);

                // Horizon glow
                const glow = ctx.createRadialGradient(W * 0.5, H * 0.8, 0, W * 0.5, H * 0.8, H * 0.6);
                glow.addColorStop(0, 'rgba(255, 0, 51, 0.06)');
                glow.addColorStop(1, 'transparent');
                ctx.fillStyle = glow;
                ctx.fillRect(0, 0, W, H);

                // Ground line
                ctx.strokeStyle = 'rgba(255, 0, 51, 0.2)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(0, H - 2);
                ctx.lineTo(W, H - 2);
                ctx.stroke();

                // Draw obstacles (world coords → screen)
                for (const o of worldObstacles) {
                    const sx = o.worldX - worldOffset;
                    if (sx > W + 60 || sx + obstW < -60) continue;

                    const topH = o.gapY - gapSize / 2;
                    ctx.fillStyle = '#1a0008';
                    ctx.fillRect(sx, 0, obstW, topH);
                    ctx.strokeStyle = '#ff0033';
                    ctx.lineWidth = 2;
                    ctx.strokeRect(sx, 0, obstW, topH);
                    ctx.shadowColor = '#ff0033';
                    ctx.shadowBlur = 10;
                    ctx.beginPath();
                    ctx.moveTo(sx, topH);
                    ctx.lineTo(sx + obstW, topH);
                    ctx.stroke();
                    ctx.shadowBlur = 0;

                    const botY = o.gapY + gapSize / 2;
                    ctx.fillStyle = '#1a0008';
                    ctx.fillRect(sx, botY, obstW, H - botY);
                    ctx.strokeStyle = '#ff0033';
                    ctx.strokeRect(sx, botY, obstW, H - botY);
                    ctx.shadowColor = '#ff0033';
                    ctx.shadowBlur = 10;
                    ctx.beginPath();
                    ctx.moveTo(sx, botY);
                    ctx.lineTo(sx + obstW, botY);
                    ctx.stroke();
                    ctx.shadowBlur = 0;
                }

                // Draw ball hazards
                for (const b of worldBalls) {
                    const sx = b.worldX - worldOffset;
                    if (sx > W + 50 || sx < -50) continue;

                    ctx.save();
                    ctx.shadowColor = '#ff3355';
                    ctx.shadowBlur = 15;
                    const gradient = ctx.createRadialGradient(sx, b.y, 0, sx, b.y, b.radius);
                    gradient.addColorStop(0, 'rgba(255, 80, 120, 0.9)');
                    gradient.addColorStop(0.6, 'rgba(255, 0, 51, 0.7)');
                    gradient.addColorStop(1, 'rgba(180, 0, 30, 0.3)');
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(sx, b.y, b.radius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                }

                // Draw waiting players (those not yet active)
                for (const wp of waitingPlayers) {
                    if (wp.active) continue;
                    const sx = wp.worldX - worldOffset;
                    if (sx > W + 100 || sx < -100) continue;
                    ctx.globalAlpha = 0.6;
                    drawRobot(sx, wp.y, wp.name, false, 0);
                    ctx.globalAlpha = 1;

                    // Name label
                    ctx.save();
                    ctx.font = `${Math.min(14, W * 0.02)}px 'JetBrains Mono', monospace`;
                    ctx.fillStyle = 'rgba(255, 51, 85, 0.5)';
                    ctx.textAlign = 'center';
                    ctx.fillText(wp.name, sx, wp.y + totalRobotH * 0.7);
                    ctx.restore();
                }

                if (handoff) {
                    const t = handoffTimer / handoffDuration;
                    const ease = t * t * (3 - 2 * t);

                    // Current robot flies ahead
                    const curX = robotScreenX + (W * 0.7) * ease;
                    drawRobot(curX, robotY, playerName, true, 0.15);

                    // Name flash for next player
                    const nextPlayer = playerIndex + 1 < players.length ? players[playerIndex + 1] : null;
                    if (nextPlayer && t > 0.2 && t < 0.85) {
                        const alpha = Math.min(1, (t - 0.2) * 5) * Math.min(1, (0.85 - t) * 5);
                        ctx.save();
                        ctx.globalAlpha = alpha;
                        ctx.font = `bold ${Math.min(48, W * 0.06)}px 'Playfair Display', serif`;
                        ctx.fillStyle = '#ff3355';
                        ctx.textAlign = 'center';
                        ctx.shadowColor = '#ff0033';
                        ctx.shadowBlur = 20;
                        ctx.fillText(nextPlayer + (nextPlayer.endsWith('s') ? ' tur!' : 's tur!'), W / 2, H / 2 - totalRobotH);
                        ctx.restore();
                    }
                } else {
                    const tilt = Math.max(-0.35, Math.min(0.35, velocity * 0.04));
                    drawRobot(robotScreenX, robotY, playerName, thrusting, tilt);
                }
            }

            function cleanup() {
                window.removeEventListener('keydown', onKeyDown);
                window.removeEventListener('keyup', onKeyUp);
                canvas.removeEventListener('touchstart', onTouchStart);
                canvas.removeEventListener('touchend', onTouchEnd);
                // Mark this player's waiting slot as active (used up)
                for (const wp of waitingPlayers) {
                    if (wp.name === playerName) wp.active = true;
                }
            }

            function gameLoop(now) {
                const result = update(now);
                if (result === 'done') return;
                draw();
                requestAnimationFrame(gameLoop);
            }
            requestAnimationFrame(gameLoop);
        }

        function showScores() {
            startScreen.style.display = 'none';
            scoresScreen.style.display = '';

            const list = document.getElementById('gameScoreList');
            list.innerHTML = '';
            const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
            sorted.forEach(([name, sc], i) => {
                const li = document.createElement('li');
                li.innerHTML = `<span class="score-name">${i === 0 ? '&#9733; ' : ''}${name}</span><span class="score-val">${sc} p</span>`;
                list.appendChild(li);
            });

            document.getElementById('gameNextBtn').textContent = 'Vidare';
            document.getElementById('gameNextBtn').onclick = () => {
                scoresScreen.style.display = 'none';
                // Play film_2 after scores
                videoScreen2.style.display = '';
                video2.play();
                video2.onended = () => {
                    videoScreen2.style.display = 'none';
                    overlay.classList.remove('active');
                    document.body.style.overflow = '';
                    document.getElementById('voting').scrollIntoView({ behavior: 'smooth' });
                };
                videoScreen2.onclick = () => {
                    video2.pause();
                    video2.onended = null;
                    videoScreen2.style.display = 'none';
                    overlay.classList.remove('active');
                    document.body.style.overflow = '';
                    document.getElementById('voting').scrollIntoView({ behavior: 'smooth' });
                };
            };
        }
    }
})();
</script>

</body>
</html>
